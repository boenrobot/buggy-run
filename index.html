<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="Vasil Rangelov (boenrobot)" name="author"><title>Buggy run</title><style type="text/css">body{touch-action:none;margin:0;background:repeating-linear-gradient(0deg,#5a7a8a 0,#5a7a8a 2px,transparent 2px,transparent 60px,#5a7a8a 60px,#5a7a8a 62px),repeating-linear-gradient(90deg,#5a7a8a 0,#5a7a8a 2px,transparent 2px,transparent 60px,#5a7a8a 60px,#5a7a8a 62px),repeating-linear-gradient(0deg,rgba(255,255,255,.1) 0,rgba(255,255,255,.05) 30px,transparent 30px,transparent 32px,rgba(0,0,0,.05) 32px,rgba(0,0,0,.1) 58px,transparent 58px,transparent 60px),repeating-linear-gradient(90deg,rgba(255,255,255,.1) 0,rgba(255,255,255,.05) 30px,transparent 30px,transparent 32px,rgba(0,0,0,.05) 32px,rgba(0,0,0,.1) 58px,transparent 58px,transparent 60px),linear-gradient(45deg,#7a9eb0 0,#8aa4b5 25%,#7a9eb0 50%,#8aa4b5 75%,#7a9eb0 100%);background-size:60px 60px,60px 60px,60px 60px,60px 60px,120px 120px;overflow:hidden;display:flex;justify-content:center;align-items:center;min-height:100vh}#game-area{background:repeating-linear-gradient(90deg,rgba(139,90,43,.1) 0,rgba(139,90,43,.15) 1px,rgba(160,113,70,.1) 2px,rgba(139,90,43,.05) 4px,transparent 6px,transparent 12px),repeating-linear-gradient(0deg,rgba(101,67,33,.08) 0,rgba(139,90,43,.12) .5px,rgba(101,67,33,.06) 1px,transparent 2px,transparent 8px),radial-gradient(ellipse at center,tan 0,peru 30%,sienna 70%,#8b4513 100%);aspect-ratio:1/1;width:min(100vw,100vh);height:min(100vw,100vh);overflow:hidden;outline:1px solid black;container-type:size;position:relative;box-shadow:inset 0 0 20px rgba(139,69,19,.3),inset 0 0 40px rgba(101,67,33,.2),0 8px 16px rgba(0,0,0,.3),0 2px 4px rgba(0,0,0,.2);border:3px solid #654321;border-radius:8px}#scoreboard{position:fixed;top:0;left:0;right:0;font-size:5vw;color:#fff;opacity:40%;z-index:100}.scoreboard-beetle{display:inline;position:absolute;left:0}.scoreboard-lady-beetle{display:inline;position:absolute;min-width:3em;overflow:visible}.achievements{font-size:10vw;position:absolute;z-index:500;pointer-events:none;opacity:20%}.achievement-bar{position:fixed;display:flex;flex-wrap:wrap;gap:.5em;font-size:3vw;z-index:200;padding:.5em;background:rgba(0,0,0,.3);border-radius:8px;max-width:5.25em}.achievement-bar-beetle{bottom:1em;left:1em}.achievement-bar-lady-beetle{bottom:1em;right:1em}.achievement-bar>span{display:inline-block;opacity:0;animation:fadeIn .5s ease-in forwards}@keyframes fadeIn{to{opacity:1}}.joystick{position:fixed;width:128px;height:128px;z-index:1000;opacity:50%}.joystick-container{width:128px;height:128px;position:relative}.joystick-base{width:100%;height:100%}.joystick-stick-container{position:absolute;left:32px;top:32px;width:64px;height:64px}.joystick-left{left:max(5vw,5vh)}.joystick-right{right:max(5vw,5vh)}@media (orientation:landscape) and (min-aspect-ratio:1/1) and (not (aspect-ratio:1/1)) and (min-width:40em){.joystick-left{top:50%;transform:translate3d(0,-50%,0)}.joystick-right{top:50%;transform:translate3d(0,-50%,0)}.scoreboard-lady-beetle{right:0;max-width:calc(50vw - min(50vw,50vh))}}@media (max-aspect-ratio:1/1),(aspect-ratio:1/1),not (min-width:40em){.joystick-left{top:max(5vw,5vh);left:50%;transform:translate3d(-50%,0,0)}.joystick-right{bottom:max(5vw,5vh);right:50%;transform:translate3d(50%,0,0)}.scoreboard-lady-beetle{left:0;right:0;top:calc(100vh - max(15vw,15vh))}.achievement-bar{max-width:12.75em}.achievement-bar-beetle{top:1em;right:1em;bottom:auto;left:auto}.achievement-bar-lady-beetle{bottom:1em;right:1em;top:auto;left:auto}}.outside{position:absolute;left:-9999px;pointer-events:none}.beetle{font-size:10cqh}.android .beetle>span:first-child,.android .roach>span:first-child,.android .scoreboard-beetle>span:first-child{display:inline-block;transform:rotate3d(0,0,1,45deg)}.lady-beetle{font-size:10cqh}.herb{font-size:5cqh}.roach,.roach-death{font-size:8cqh}.raindrop{font-size:5cqh}.spider{font-size:10cqh}.web{font-size:20cqh}.fly{font-size:6cqh}.android .fly>span:first-child{display:inline-block;transform:rotate3d(0,0,1,120deg)}.entity{position:absolute;padding:0;margin:0;will-change:transform;transform:translate3d(0,0,0);backface-visibility:hidden}#scoreboard,.achievement-bar,text{-webkit-user-select:none;user-select:none}</style></head><body><div id="scoreboard"><p class="scoreboard-beetle"><span>ğŸª²</span> : <span class="score">0</span></p><p class="scoreboard-lady-beetle"><span>ğŸ</span> : <span class="score">0</span></p></div><div id="game-area"></div><div class="achievement-bar achievement-bar-beetle"></div><div class="achievement-bar achievement-bar-lady-beetle"></div><svg class="outside" height="0" width="0" aria-hidden="true"><defs><radialGradient cx="35%" cy="30%" id="joystickStickHighlight" r="65%"><stop offset="0%" stop-color="#ffffff" stop-opacity="0.75"/><stop offset="40%" stop-color="#ffffff" stop-opacity="0.15"/><stop offset="100%" stop-color="#ffffff" stop-opacity="0"/></radialGradient><filter height="160%" id="joystickStickShadow" width="160%" x="-30%" y="-30%"><feDropShadow dx="0" dy="2" flood-color="#000" flood-opacity="0.4" stdDeviation="2"/></filter><radialGradient cx="50%" cy="45%" id="joystickBaseGrad" r="55%"><stop offset="0%" stop-color="#fafafa"/><stop offset="45%" stop-color="#c9c9c9"/><stop offset="100%" stop-color="#7d7d7d"/></radialGradient><radialGradient cx="50%" cy="55%" id="joystickBaseInner" r="50%"><stop offset="0%" stop-color="#595959"/><stop offset="70%" stop-color="#2e2e2e"/><stop offset="100%" stop-color="#111"/></radialGradient><filter height="140%" id="joystickBaseShadow" width="140%" x="-20%" y="-20%"><feDropShadow dx="0" dy="4" flood-color="#000" flood-opacity="0.35" stdDeviation="4"/></filter><symbol id="joystick-base-symbol" viewBox="0 0 128 128"><circle cx="64" cy="64" fill="url(#joystickBaseGrad)" r="60" filter="url(#joystickBaseShadow)"/><circle cx="64" cy="64" fill="none" r="44" stroke="#000" stroke-opacity="0.35" stroke-width="2"/><circle cx="64" cy="64" fill="#1c1c1c" r="42"/><circle cx="64" cy="64" fill="url(#joystickBaseInner)" r="34"/><g stroke="#fff" stroke-opacity=".12" stroke-width="2"><line x1="64" x2="64" y1="40" y2="88"/><line x1="40" x2="88" y1="64" y2="64"/></g><path d="M20 64a44 44 0 0 1 72.5-33" fill="none" stroke="#fff" stroke-linecap="round" stroke-opacity=".25" stroke-width="5"/><g stroke="#000" stroke-opacity=".55" stroke-width="1.3" fill="#1c1c1c" id="arrows" stroke-linejoin="round"><polygon points="64,8 56,20 72,20"/><polygon points="120,64 108,56 108,72"/><polygon points="64,120 56,108 72,108"/><polygon points="8,64 20,56 20,72"/></g></symbol><symbol id="joystick-base-left" viewBox="0 0 128 128"><use href="#joystick-base-symbol"/><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="64" y="10">W</text><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="118" y="68">D</text><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="64" y="123">S</text><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="10" y="68">A</text></symbol><symbol id="joystick-base-right" viewBox="0 0 128 128"><use href="#joystick-base-symbol"/><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="64" y="10">I</text><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="118" y="68">L</text><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="64" y="123">K</text><text fill="#fff" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle" x="10" y="68">J</text></symbol></defs></svg><template id="player1-template"><div class="entity beetle" id="beetle"><span>ğŸª²</span></div></template><template id="player2-template"><div class="entity lady-beetle" id="lady-beetle">ğŸ</div></template><template id="collectible-template"><div class="entity herb">ğŸŒ¿</div></template><template id="swiper-template"><div class="entity roach"><span>ğŸª³</span></div></template><template id="boon-template"><div class="entity raindrop">ğŸ’§</div></template><template id="waker-template"><div class="entity spider">ğŸ•·ï¸</div></template><template id="trace-template"><div class="entity web">ğŸ•¸ï¸</div></template><template id="swiper-death-template"><div class="entity roach-death">ğŸ’¥</div></template><template id="chaos-template"><div class="entity fly"><span>ğŸª°</span></div></template><template id="joystick-template"><div class="joystick-container"><svg class="joystick-base" viewBox="0 0 128 128"><use href="#joystick-base-symbol"/></svg><div class="joystick-stick-container"><svg class="joystick-stick" height="64" width="64" color="#000000" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" fill="currentColor" r="28" filter="url(#joystickStickShadow)"/><circle cx="32" cy="32" fill="url(#joystickStickHighlight)" r="28"/><circle cx="32" cy="32" fill="none" r="28" stroke="#000" stroke-opacity=".35" stroke-width="2"/></svg></div></div></template><script type="text/javascript">class JoystickController{#e={};constructor(e,t,n,s,o){this.stick=e,this.container=o;for(const[e,t]of Object.entries(s))["up","down","left","right"].includes(e)&&(this.#e[e]={pressed:new KeyboardEvent("keydown",{key:t}),released:new KeyboardEvent("keyup",{key:t})});this.dragStart=null,this.touchId=null,this.active=!1,this.value={x:0,y:0};let a=this;function i(){a.#e?.right&&(a.value.x>.15?document.dispatchEvent(a.#e.right.pressed):document.dispatchEvent(a.#e.right.released)),a.#e?.left&&(a.value.x<-.15?document.dispatchEvent(a.#e.left.pressed):document.dispatchEvent(a.#e.left.released)),a.#e?.down&&(a.value.y>.15?document.dispatchEvent(a.#e.down.pressed):document.dispatchEvent(a.#e.down.released)),a.#e?.up&&(a.value.y<-.15?document.dispatchEvent(a.#e.up.pressed):document.dispatchEvent(a.#e.up.released))}function l(t){a.active=!0,e.style.transition="0s",t.preventDefault(),t.changedTouches?a.dragStart={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}:a.dragStart={x:t.clientX,y:t.clientY},t.changedTouches&&(a.touchId=t.changedTouches[0].identifier)}function r(s){if(!a.active)return;let o=null;if(s.changedTouches){for(let e=0;e<s.changedTouches.length;e++)a.touchId==s.changedTouches[e].identifier&&(o=e,s.clientX=s.changedTouches[e].clientX,s.clientY=s.changedTouches[e].clientY);if(null==o)return}const l=s.clientX-a.dragStart.x,r=s.clientY-a.dragStart.y,c=Math.atan2(r,l),d=Math.min(t,Math.hypot(l,r)),h=d*Math.cos(c),p=d*Math.sin(c);e.style.transform=`translate3d(${h}px, ${p}px, 0px)`;const y=d<n?0:t/(t-n)*(d-n),m=y*Math.cos(c),u=y*Math.sin(c),g=parseFloat((m/t).toFixed(4)),f=parseFloat((u/t).toFixed(4));a.value={x:g,y:f},i()}function c(t){a.active&&(t.changedTouches&&a.touchId!=t.changedTouches[0].identifier||(e.style.transition=".2s",e.style.transform="translate3d(0px, 0px, 0px)",a.value={x:0,y:0},a.touchId=null,a.active=!1,i()))}e.addEventListener("mousedown",l),e.addEventListener("touchstart",l),document.addEventListener("mousemove",r,{passive:!1}),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("mouseup",c),document.addEventListener("touchend",c)}moveToPosition(e,t){const n=this.container.getBoundingClientRect(),s=n.width/2,o=n.height/2;this.container.style.left=e-s+"px",this.container.style.top=t-o+"px",this.container.style.right="auto",this.container.style.bottom="auto",this.container.style.transform="none"}getCenterPosition(){const e=this.container.getBoundingClientRect();return{x:e.left+e.width/2,y:e.top+e.height/2}}startDragFromPosition(e,t,n=null){this.active=!0,this.stick.style.transition="0s",this.dragStart={x:e,y:t},this.touchId=n}resetPosition(){this.container.style.left="",this.container.style.top="",this.container.style.right="",this.container.style.bottom="",this.container.style.transform=""}}const gameArea=document.getElementById("game-area"),player1template=document.getElementById("player1-template").content,player2template=document.getElementById("player2-template").content,collectibletemplate=document.getElementById("collectible-template").content,swipertemplate=document.getElementById("swiper-template").content,swiperDeathTemplate=document.getElementById("swiper-death-template").content,wakerTemplate=document.getElementById("waker-template").content,traceTemplate=document.getElementById("trace-template").content,boontemplate=document.getElementById("boon-template").content,joysticktemplate=document.getElementById("joystick-template").content,chaosTemplate=document.getElementById("chaos-template").content,player1ScoreElement=document.querySelector(".scoreboard-beetle .score"),player2ScoreElement=document.querySelector(".scoreboard-lady-beetle .score"),player1AchievementBar=document.querySelector(".achievement-bar-beetle"),player2AchievementBar=document.querySelector(".achievement-bar-lady-beetle"),player1Achievements=new Set,player2Achievements=new Set,achievementMilestones={10:"ğŸ",16:"ğŸ’€",21:"ğŸƒ",25:"ğŸ„",31:"ğŸƒ",42:"ğŸ›¸",51:"ğŸ‘½",64:"ğŸ„",69:"â˜¯ï¸",88:"ğŸ¹",100:"ğŸ’¯",360:"ğŸ®",420:"ğŸš¬",777:"ğŸ°",888:"ğŸ§§",1e3:"ğŸ†",1337:"ğŸ–¥ï¸",1776:"ğŸ—½",3e3:"â¤ï¸",4321:"ğŸ”¢",9e3:"ğŸ‰"};navigator.userAgent.includes("; Android ")&&document.body.classList.add("android");const keysPressed=new Set,collectibles=[],swipers=[],boons=[],spiders=[],webs=[],chaosEntities=[];let lastHerbCollectionTime=Date.now(),lastPlayerMovementTime=Date.now();const edges=["top","right","bottom","left"];function placeGameEntity(e,t,n){e.style.bottom=t,e.style.left=n}function getRandomPosition(){return{bottom:80*Math.random()+10+"%",left:80*Math.random()+10+"%"}}function spawnCollectible(){const e=collectibletemplate.cloneNode(!0).children[0],t=getRandomPosition();return placeGameEntity(e,t.bottom,t.left),gameArea.appendChild(e),collectibles.push(e),e}function spawnBoon(){const e=boontemplate.cloneNode(!0).children[0],t=getRandomPosition();return placeGameEntity(e,t.bottom,t.left),gameArea.appendChild(e),boons.push(e),e}function spawnSwiper(){const e=swipertemplate.cloneNode(!0).children[0];let t,n,s,o;switch(edges[Math.floor(Math.random()*edges.length)]){case"top":e.style.transform="rotate3d(0, 0, 1, 180deg)",t=92*Math.random()+4,n=110,s=t,o=-20;break;case"bottom":e.style.transform="rotate3d(0, 0, 1, 0deg)",t=92*Math.random()+4,n=-20,s=t,o=110;break;case"left":e.style.transform="rotate3d(0, 0, 1, 90deg)",t=-20,n=92*Math.random()+4,s=120,o=n;break;case"right":e.style.transform="rotate3d(0, 0, 1, -90deg)",t=120,n=92*Math.random()+4,s=-20,o=n}return e.style.left=t+"%",e.style.bottom=n+"%",gameArea.appendChild(e),swipers.push(e),moveSwiper(e,t,n,s,o),swipers.length%10==0&&swipers.length>0&&spawnChaos(),e}function moveSwiper(e,t,n,s,o){const a=Date.now(),i=()=>{const l=Date.now()-a,r=Math.min(l/3e3,1),c=t+(s-t)*r,d=n+(o-n)*r;if(e.style.left=c+"%",e.style.bottom=d+"%",handleSwiperCollision(e),r<1)requestAnimationFrame(i);else{const t=swipers.indexOf(e);t>-1&&(swipers.splice(t,1),e.remove())}};requestAnimationFrame(i)}function handleSwiperCollision(e){if(areEntitiesColliding(e,player1)){const t=parseInt(player1ScoreElement.textContent);player1ScoreElement.textContent=Math.max(0,t-2),spawnSwiperDeath(e);const n=swipers.indexOf(e);n>-1&&(swipers.splice(n,1),e.remove())}if(areEntitiesColliding(e,player2)){const t=parseInt(player2ScoreElement.textContent);player2ScoreElement.textContent=Math.max(0,t-1),spawnSwiperDeath(e);const n=swipers.indexOf(e);n>-1&&(swipers.splice(n,1),e.remove())}handleCollectibleCollection(e),handleBoonCollection(e),handleWebCollision(e);for(let t=spiders.length-1;t>=0;t--)if(areEntitiesColliding(e,spiders[t])){spawnSwiperDeath(e);const t=swipers.indexOf(e);if(t>-1){swipers.splice(t,1),e.remove();break}}for(let t=chaosEntities.length-1;t>=0;t--)if(areEntitiesColliding(e,chaosEntities[t])){spawnSwiperDeath(e);const t=swipers.indexOf(e);if(t>-1){swipers.splice(t,1),e.remove();break}}}function areEntitiesColliding(e,t){const n=e.getBoundingClientRect(),s=t.getBoundingClientRect();if(n.right<s.left||n.left>s.right||n.bottom<s.top||n.top>s.bottom)return!1;const o=n.left+n.width/2,a=n.top+n.height/2,i=s.left+s.width/2,l=s.top+s.height/2,r=Math.min(n.width,n.height)/2,c=Math.min(s.width,s.height)/2,d=i-o,h=l-a;return Math.sqrt(d*d+h*h)<r+c-Math.abs(r-c)/1.1}function handleBoonCollection(e){for(let t=boons.length-1;t>=0;t--)if(areEntitiesColliding(e,boons[t])){boons[t].remove(),boons.splice(t,1),spawnCollectible(),spawnCollectible(),e.classList.contains("roach")&&(spawnSwiper(),spawnSwiper(),spawnSwiper()),e.classList.contains("spider")&&(spawnWeb(e),spawnWaker());break}}function handleCollectibleCollection(e){for(let t=collectibles.length-1;t>=0;t--)if(areEntitiesColliding(e,collectibles[t])){if(collectibles[t].remove(),collectibles.splice(t,1),e.classList.contains("roach")){spawnSwiper(),spawnSwiper(),collectibles.length<2&&spawnCollectible();break}lastHerbCollectionTime=Date.now();const n=e.classList.contains("beetle")?player1ScoreElement:player2ScoreElement,s=parseInt(n.textContent)+1;if(n.textContent=s,achievementMilestones[s]){const t=achievementMilestones[s],n=e.classList.contains("beetle"),o=n?player1Achievements:player2Achievements;o.has(s)||(o.add(s),spawnAchievement(e,t),addAchievementToBar(n,t))}s>=10&&spawnSwiper(),s%5==0&&s>0&&spawnBoon(),collectibles.length<2&&spawnCollectible();break}}function updatePlayerRotation(e){const t=e.id,n=keysPressed.has(`${t}-up`),s=keysPressed.has(`${t}-down`),o=keysPressed.has(`${t}-left`),a=keysPressed.has(`${t}-right`);n&&o?e.style.transform="rotate3d(0, 0, 1, -45deg)":n&&a?e.style.transform="rotate3d(0, 0, 1, 45deg)":s&&o?e.style.transform="rotate3d(0, 0, 1, -135deg)":s&&a?e.style.transform="rotate3d(0, 0, 1, 135deg)":n?e.style.transform="rotate3d(0, 0, 1, 0deg)":s?e.style.transform="rotate3d(0, 0, 1, 180deg)":o?e.style.transform="rotate3d(0, 0, 1, -90deg)":a&&(e.style.transform="rotate3d(0, 0, 1, 90deg)")}function movePlayer(e,t,n){const s=()=>{const o=e.getBoundingClientRect(),a=gameArea.getBoundingClientRect();let i=!1;switch(t){case"up":o.top>a.top&&(e.style.bottom=`${parseInt(e.style.bottom)+n}%`,i=!0);break;case"left":o.left>a.left&&(e.style.left=parseInt(e.style.left)-n+"%",i=!0);break;case"down":o.bottom<a.bottom&&(e.style.bottom=parseInt(e.style.bottom)-n+"%",i=!0);break;case"right":o.right<a.right&&(e.style.left=`${parseInt(e.style.left)+n}%`,i=!0)}i&&(lastPlayerMovementTime=Date.now()),updatePlayerRotation(e),handleCollectibleCollection(e),handleBoonCollection(e),handleWebCollision(e),i&&keysPressed.has(`${e.id}-${t}`)&&requestAnimationFrame(s)};requestAnimationFrame(s)}const player1=player1template.cloneNode(!0).children[0];placeGameEntity(player1,"0%","20%"),gameArea.appendChild(player1);const player2=player2template.cloneNode(!0).children[0];placeGameEntity(player2,"0%","70%"),gameArea.appendChild(player2),gameArea.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()});const leftJoystick=joysticktemplate.cloneNode(!0).children[0];leftJoystick.className="joystick joystick-left",leftJoystick.querySelector(".joystick-stick").style.color="#00ff00",leftJoystick.querySelector(".joystick-base use").setAttribute("href","#joystick-base-left"),document.body.insertBefore(leftJoystick,gameArea);let joystick1=new JoystickController(leftJoystick.querySelector(".joystick-stick-container"),64,8,{up:"w",down:"s",left:"a",right:"d"},leftJoystick);const rightJoystick=joysticktemplate.cloneNode(!0).children[0];rightJoystick.className="joystick joystick-right",rightJoystick.querySelector(".joystick-stick").style.color="#ff0000",rightJoystick.querySelector(".joystick-base use").setAttribute("href","#joystick-base-right"),document.body.appendChild(rightJoystick);let resizeTimeout,joystick2=new JoystickController(rightJoystick.querySelector(".joystick-stick-container"),64,8,{up:"i",down:"k",left:"j",right:"l"},rightJoystick);function handleOrientationChange(){joystick1.resetPosition(),joystick2.resetPosition()}function handlePointerDownOutsideGameArea(e){const t=e.changedTouches?e.changedTouches[0].clientX:e.clientX,n=e.changedTouches?e.changedTouches[0].clientY:e.clientY,s=e.changedTouches?e.changedTouches[0].identifier:null,o=gameArea.getBoundingClientRect();if(t>=o.left&&t<=o.right&&n>=o.top&&n<=o.bottom)return;const a=joystick1.getCenterPosition(),i=joystick2.getCenterPosition(),l=Math.hypot(t-a.x,n-a.y)<=Math.hypot(t-i.x,n-i.y)?joystick1:joystick2;l.moveToPosition(t,n),l.startDragFromPosition(t,n,s),e.preventDefault()}function spawnWaker(){const e=wakerTemplate.cloneNode(!0).children[0];let t,n,s,o;switch(edges[Math.floor(Math.random()*edges.length)]){case"top":e.style.transform="rotate3d(0, 0, 1, 180deg)",t=92*Math.random()+4,n=110,s=t,o=-20;break;case"bottom":e.style.transform="rotate3d(0, 0, 1, 0deg)",t=92*Math.random()+4,n=-20,s=t,o=110;break;case"left":e.style.transform="rotate3d(0, 0, 1, 90deg)",t=-20,n=92*Math.random()+4,s=120,o=n;break;case"right":e.style.transform="rotate3d(0, 0, 1, -90deg)",t=120,n=92*Math.random()+4,s=-20,o=n}return e.style.left=t+"%",e.style.bottom=n+"%",gameArea.appendChild(e),spiders.push(e),moveWaker(e,t,n,s,o),e}function moveWaker(e,t,n,s,o){const a=Date.now();let i=0;const l=setInterval(()=>{if(i>=2)return void clearInterval(l);if(Math.random()>=.5)return;const t=e.getBoundingClientRect(),n=gameArea.getBoundingClientRect(),s=t.left+t.width/2,o=t.top+t.height/2;s<n.left||s>n.right||o<n.top||o>n.bottom||(spawnWeb(e),i++)},500),r=()=>{const i=Date.now()-a,c=Math.min(i/6e3,1),d=t+(s-t)*c,h=n+(o-n)*c;if(e.style.left=d+"%",e.style.bottom=h+"%",handleWakerCollision(e),handleBoonCollection(e),c<1)requestAnimationFrame(r);else{clearInterval(l);const t=spiders.indexOf(e);t>-1&&(spiders.splice(t,1),e.remove())}};requestAnimationFrame(r)}function spawnWeb(e){const t=traceTemplate.cloneNode(!0).children[0],n=e.getBoundingClientRect(),s=gameArea.getBoundingClientRect(),o=n.left+n.width/2,a=n.top+n.height/2,i=(o-s.left)/s.width*100,l=100-(a-s.top)/s.height*100;t.style.left=i-5+"%",t.style.bottom=l-5+"%",gameArea.appendChild(t),webs.push(t),areEntitiesColliding(player1,t)&&handleWebCollision(player1),areEntitiesColliding(player2,t)&&handleWebCollision(player2)}function handleWakerCollision(e){if(areEntitiesColliding(e,player1)){const t=parseInt(player1ScoreElement.textContent);player1ScoreElement.textContent=Math.max(0,t-3);const n=spiders.indexOf(e);n>-1&&(spiders.splice(n,1),e.remove())}if(areEntitiesColliding(e,player2)){const t=parseInt(player2ScoreElement.textContent);player2ScoreElement.textContent=Math.max(0,t-3);const n=spiders.indexOf(e);n>-1&&(spiders.splice(n,1),e.remove())}}function handleWebCollision(e){for(let t=webs.length-1;t>=0;t--)if(areEntitiesColliding(e,webs[t])){if(webs[t].remove(),webs.splice(t,1),e.classList.contains("roach")){swipers.splice(swipers.indexOf(e),1),e.remove();break}const n=e.classList.contains("beetle")?player1ScoreElement:player2ScoreElement,s=parseInt(n.textContent);n.textContent=Math.max(0,s-2);break}}function spawnSwiperDeath(e){const t=swiperDeathTemplate.cloneNode(!0).children[0];t.style.left=e.style.left,t.style.bottom=e.style.bottom,gameArea.appendChild(t),setTimeout(()=>{t.remove()},100)}function spawnAchievement(e,t){const n=document.createElement("div");n.className="achievements",n.textContent=t;const s=e.getBoundingClientRect();n.style.left=s.left+"px",n.style.top=s.top+"px",document.body.appendChild(n),setTimeout(()=>{n.remove()},2e3)}function addAchievementToBar(e,t){(e?player1AchievementBar:player2AchievementBar).innerHTML+=`<span>${t}</span>`}function spawnChaos(){const e=chaosTemplate.cloneNode(!0).children[0],t=[{x:0,y:0,targetX:100,targetY:100},{x:100,y:0,targetX:0,targetY:100},{x:0,y:100,targetX:100,targetY:0},{x:100,y:100,targetX:0,targetY:0}],n=t[Math.floor(Math.random()*t.length)];return e.style.left=n.x+"%",e.style.bottom=n.y+"%",gameArea.appendChild(e),chaosEntities.push(e),moveChaos(e,n.x,n.y,n.targetX,n.targetY),e}function updateChaosRotation(e,t){const{x:n,y:s}=t;s>0&&n<0?e.style.transform="rotate3d(0, 0, 1, -45deg)":s>0&&n>0?e.style.transform="rotate3d(0, 0, 1, 45deg)":s<0&&n<0?e.style.transform="rotate3d(0, 0, 1, -135deg)":s<0&&n>0?e.style.transform="rotate3d(0, 0, 1, 135deg)":s>0?e.style.transform="rotate3d(0, 0, 1, 0deg)":s<0?e.style.transform="rotate3d(0, 0, 1, 180deg)":n<0?e.style.transform="rotate3d(0, 0, 1, -90deg)":n>0&&(e.style.transform="rotate3d(0, 0, 1, 90deg)")}function moveChaos(e,t,n,s,o){const a=Date.now();let i=0;let l=t,r=n,c={x:(s-t)/Math.abs(s-t||1),y:(o-n)/Math.abs(o-n||1)};updateChaosRotation(e,c);const d=setInterval(()=>{if(i>=10)return void clearInterval(d);const t=[{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:1,y:-1},{x:0,y:-1},{x:-1,y:-1},{x:-1,y:0},{x:-1,y:1}],n=t[Math.floor(Math.random()*t.length)];c=n,updateChaosRotation(e,c),i++},1500),h=()=>{const t=Date.now()-a,n=Math.min(t/6e3,1),s=16*(141.42/6e3);if(l+=c.x*s,r+=c.y*s,e.style.left=l+"%",e.style.bottom=r+"%",handleChaosCollision(e),n<1)requestAnimationFrame(h);else{clearInterval(d);const t=e.getBoundingClientRect(),n=gameArea.getBoundingClientRect();if(t.right<n.left||t.left>n.right||t.bottom<n.top||t.top>n.bottom){const t=chaosEntities.indexOf(e);return void(t>-1&&(chaosEntities.splice(t,1),e.remove()))}requestAnimationFrame(h)}};requestAnimationFrame(h)}function handleChaosCollision(e){if(areEntitiesColliding(e,player1)){spawnSwiperDeath(e);const t=chaosEntities.indexOf(e);t>-1&&(chaosEntities.splice(t,1),e.remove());const n=parseInt(player1ScoreElement.textContent);player1ScoreElement.textContent=Math.max(0,n-1)}if(areEntitiesColliding(e,player2)){spawnSwiperDeath(e);const t=chaosEntities.indexOf(e);t>-1&&(chaosEntities.splice(t,1),e.remove());const n=parseInt(player2ScoreElement.textContent);player2ScoreElement.textContent=Math.max(0,n-1)}for(let t=webs.length-1;t>=0;t--)if(areEntitiesColliding(e,webs[t])){spawnSwiperDeath(e);const n=chaosEntities.indexOf(e);n>-1&&(chaosEntities.splice(n,1),e.remove()),webs[t].remove(),webs.splice(t,1);break}for(let t=spiders.length-1;t>=0;t--)if(areEntitiesColliding(e,spiders[t])){spawnSwiperDeath(e);const t=chaosEntities.indexOf(e);t>-1&&(chaosEntities.splice(t,1),e.remove());break}}window.addEventListener("orientationchange",handleOrientationChange),window.addEventListener("resize",()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{const e=window.innerWidth/window.innerHeight;(!window.lastAspectRatio||Math.abs(e-window.lastAspectRatio)>.3)&&(handleOrientationChange(),window.lastAspectRatio=e)},100)}),window.lastAspectRatio=window.innerWidth/window.innerHeight,document.addEventListener("mousedown",handlePointerDownOutsideGameArea,{passive:!1}),document.addEventListener("touchstart",handlePointerDownOutsideGameArea,{passive:!1}),spawnCollectible(),spawnCollectible(),setInterval(()=>{const e=Date.now(),t=e-lastHerbCollectionTime,n=e-lastPlayerMovementTime,s=parseInt(player1ScoreElement.textContent),o=parseInt(player2ScoreElement.textContent);(t>=6e3&&Math.round(t/1e3)%3==0||n>=4e3&&Math.round(n/1e3)%4==0)&&(s>15||o>15)&&spawnWaker()},1e3),document.addEventListener("keydown",e=>{switch(e.key){case"w":case"W":keysPressed.has("beetle-up")||(keysPressed.add("beetle-up"),movePlayer(player1,"up",1));break;case"a":case"A":keysPressed.has("beetle-left")||(keysPressed.add("beetle-left"),movePlayer(player1,"left",1));break;case"s":case"S":keysPressed.has("beetle-down")||(keysPressed.add("beetle-down"),movePlayer(player1,"down",1));break;case"d":case"D":keysPressed.has("beetle-right")||(keysPressed.add("beetle-right"),movePlayer(player1,"right",1));break;case"i":case"I":keysPressed.has("lady-beetle-up")||(keysPressed.add("lady-beetle-up"),movePlayer(player2,"up",1));break;case"j":case"J":keysPressed.has("lady-beetle-left")||(keysPressed.add("lady-beetle-left"),movePlayer(player2,"left",1));break;case"k":case"K":keysPressed.has("lady-beetle-down")||(keysPressed.add("lady-beetle-down"),movePlayer(player2,"down",1));break;case"l":case"L":keysPressed.has("lady-beetle-right")||(keysPressed.add("lady-beetle-right"),movePlayer(player2,"right",1))}}),document.addEventListener("keyup",e=>{switch(e.key){case"w":case"W":keysPressed.delete("beetle-up");break;case"a":case"A":keysPressed.delete("beetle-left");break;case"s":case"S":keysPressed.delete("beetle-down");break;case"d":case"D":keysPressed.delete("beetle-right");break;case"i":case"I":keysPressed.delete("lady-beetle-up");break;case"j":case"J":keysPressed.delete("lady-beetle-left");break;case"k":case"K":keysPressed.delete("lady-beetle-down");break;case"l":case"L":keysPressed.delete("lady-beetle-right")}})</script></body></html>